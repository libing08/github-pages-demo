<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>d3测试</title>
		<script src="https://d3js.org/d3.v5.js"></script>
		<style type="text/css">
			.myrect {fill: #42B983;}
		</style>
	</head>
	<body>
		<svg width=600 height=400></svg>
	</body>
	<script type="text/javascript">
		renderRectByScale();
		// 使用比例尺和坐标轴构建柱状图
		function renderRectByScale(){
			var dataset = [1.8, 2.5 , 0.4 , 2.1 , 3.5, 1.7 , 1.3 , 0.9 , 2.8];  
			var svg = d3.select('svg'), g = svg.append('g').attr('transform', `translate(30, 30) `);
			var y = 300;
			
			//定义一个线性比例尺
			var scaleLinear = d3.scaleLinear().domain([0,d3.max(dataset)]).range([0,300]);
			
			g.selectAll('rect').data(dataset).enter().append('rect')
				.attr('x', (d,i)=>i*40)
				.attr('y', d=>y-scaleLinear(d))
				.attr('width', 30)
				.attr('height', d=>scaleLinear(d))
				.attr('class', 'myrect');
				
			// 定义一个坐标轴
			var xAxis = d3.axisTop(scaleLinear) // 定义axis top表示向上
							.ticks(dataset.length*2); // 设置刻度数目
			// 添加坐标轴 （相当于逆时针旋转90度，竖着展示）
			g.append('g').attr('transform', `translate(-10, ${y}) rotate(270)`).call(xAxis);
		}
		
		// 序数比例尺： domain域和range域是离散的，也就是数组
		function scaleOrdinalTest1(){
			var index = [0,1,2,3,4],color = ["red","blue","yellow","black","green"];
			var scaleOrdinal = d3.scaleOrdinal().domain(index).range(color);
			
			document.write("scaleOrdinal(1)输出：" + scaleOrdinal(1));
			d3.select('body').append('br');
			document.write("scaleOrdinal(2)输出：" + scaleOrdinal(2));
			d3.select('body').append('br');
			document.write("scaleOrdinal(4)输出：" + scaleOrdinal(4));
		}
		// 线性比例尺
		function scaleLinear1(){
			var ds = [1.2,2.3,0.9,1.5,3.3], min = d3.min(ds), max = d3.max(ds);
			//[0.9,3.3]映射 [0,300]
			var scaleLinear = d3.scaleLinear().domain([min, max]).range([0, 300]);
			document.write("scaleLinear(1)输出：" + scaleLinear(1));
			d3.select('body').append('br');
			document.write("scaleLinear(2)输出：" + scaleLinear(2));
			d3.select('body').append('br');
			document.write("scaleLinear(3.3)输出：" + scaleLinear(3.3));
		}
		// 递增阶梯柱状图
		function renderRect2(){
			var svg = d3.select('svg'),
				g = svg.append('g').attr('transform', 'translate(100, 100)')
			var y = 200;
			g.selectAll('rect').data([1,2,3,4,5,6])
				.enter()
				.append('rect')
				.attr('y', d=>y-d*30).attr('x', (d,i)=> i * 40)
				.attr('height', d=>d*30).attr('width', 30).attr('class', 'myrect');
		}
		// 横向递减柱状图
		function renderRect1(){
			var marge = {
				top: 60,
				bottom: 60,
				left: 60,
				right: 60
			} //设置边距
			var dataset = [250, 210, 170, 130, 90]; //数据（表示矩形的宽度）
			var svg = d3.select('svg'),
				g = svg.append('g').attr('transform', `translate(${marge.top}, ${marge.left})`); // translate 设置位置
			
			var rectHeight = 30; // 矩形高度
			g.selectAll('rect').data(dataset).enter().append('rect')
				.attr('x', 20) // 设置左上点的x
				.attr('y', (d, i)=> {
					return i * rectHeight;
				})
				.attr('width', d=>d)
				.attr('height', rectHeight - 5)
				.attr('class', 'myrect');
		}
	</script>
</html>
