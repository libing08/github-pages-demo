<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>d3测试</title>
		<script src="https://d3js.org/d3.v5.js"></script>
		<style type="text/css">
			.myrect {fill: #42B983;}
		</style>
	</head>
	<body>
		<svg width=600 height=400 style="border: 1px solid;"></svg>
	</body>
	<script type="text/javascript">
		renderFullRect();
		// 完整的柱状图（包含横纵坐标和文字）
		function renderFullRect(){
			var svgPadding = 40;
			var svg = d3.select('svg'), g = svg.append('g').attr('transform', `translate(${svgPadding},${svgPadding})`);
			var svgHeight = svg.attr('height');
			var dataset = [10,20,30,23,13,40,27,35,20];
			// d3.range重点了解, rangeRound
			var xScale = d3.scaleBand().domain(d3.range(dataset.length)).rangeRound([0, svg.attr('width')-svgPadding -svgPadding]);
			var xAxis = d3.axisBottom(xScale);
			// range从大到小，对应的值反比例关系，对应y轴上，y越大，其实高度越低
			var yScale = d3.scaleLinear().domain([0,d3.max(dataset)]).range([svgHeight-svgPadding-svgPadding, 0]);
			var yAxis = d3.axisLeft(yScale);
			var rectPadding = 20;//矩形之间的间隙
			// 创建分组（包含矩形和文字）
			var gs = g.selectAll('g').data(dataset).enter().append('g');
			gs.append('rect')
				.attr('x', (d,i)=>xScale(i)+rectPadding/2)
				.attr('y', d=>yScale(d))
				.attr('width', d=>xScale.step()-rectPadding) //宽度=比例值-间隙
				.attr('height', d=>svgHeight - svgPadding - svgPadding -yScale(d)) // -svgPadding-svgPadding 代表top和bottom，svg的内边距
				.attr('class', 'myrect');
			gs.append('text')
				.attr('x', (d,i)=>xScale(i))
				.attr('y', d=>yScale(d))
				.attr('dx', ()=>(xScale.step()-rectPadding)/2) // 柱状居中
				.attr('dy',20) // 向下偏移20，距离柱图顶部
				.text(d=>d);
			// 添加坐标轴	
			g.append('g').attr('transform', `translate(0, ${svgHeight-svgPadding-svgPadding})`).call(xAxis);
			g.append('g').call(yAxis);
			
		}
		// 使用比例尺和坐标轴构建柱状图
		function renderRectByScale(){
			var dataset = [1.8, 2.5 , 0.4 , 2.1 , 3.5, 1.7 , 1.3 , 0.9 , 2.8];  
			var svg = d3.select('svg'), g = svg.append('g').attr('transform', `translate(50, 30) `);
			var y = 300;
			
			//定义一个线性比例尺
			var scaleLinear = d3.scaleLinear().domain([0,d3.max(dataset)]).range([0,300]);
			
			g.selectAll('rect').data(dataset).enter().append('rect')
				.attr('x', (d,i)=>i*40)
				.attr('y', d=>y-scaleLinear(d)) 
				.attr('width', 30)
				.attr('height', d=>scaleLinear(d))
				.attr('class', 'myrect');
				
			// 定义一个坐标轴
			// var xAxis = d3.axisTop(scaleLinear) // 定义axis top表示向上
			// 				.ticks(dataset.length*2); // 设置刻度数目
			// // 添加坐标轴 （相当于逆时针旋转90度，竖着展示）
			// g.append('g').attr('transform', `translate(-10, ${y}) rotate(270)`).call(xAxis);
			var yAxis = d3.axisLeft(d3.scaleLinear().domain([0,d3.max(dataset)]).range([300,0])).ticks(dataset.length*2);
			g.append('g').attr('transform', 'translate(-10)').call(yAxis)
		}
		
		// 序数比例尺： domain域和range域是离散的，也就是数组
		function scaleOrdinalTest1(){
			var index = [0,1,2,3,4],color = ["red","blue","yellow","black","green"];
			var scaleOrdinal = d3.scaleOrdinal().domain(index).range(color);
			
			document.write("scaleOrdinal(1)输出：" + scaleOrdinal(1));
			d3.select('body').append('br');
			document.write("scaleOrdinal(2)输出：" + scaleOrdinal(2));
			d3.select('body').append('br');
			document.write("scaleOrdinal(4)输出：" + scaleOrdinal(4));
		}
		// 线性比例尺
		function scaleLinear1(){
			var ds = [1.2,2.3,0.9,1.5,3.3], min = d3.min(ds), max = d3.max(ds);
			//[0.9,3.3]映射 [0,300]
			var scaleLinear = d3.scaleLinear().domain([min, max]).range([0, 300]);
			document.write("scaleLinear(1)输出：" + scaleLinear(1));
			d3.select('body').append('br');
			document.write("scaleLinear(2)输出：" + scaleLinear(2));
			d3.select('body').append('br');
			document.write("scaleLinear(3.3)输出：" + scaleLinear(3.3));
		}
		// 递增阶梯柱状图
		function renderRect2(){
			var svg = d3.select('svg'),
				g = svg.append('g').attr('transform', 'translate(100, 100)')
			var y = 200;
			g.selectAll('rect').data([1,2,3,4,5,6])
				.enter()
				.append('rect')
				.attr('y', d=>y-d*30).attr('x', (d,i)=> i * 40)
				.attr('height', d=>d*30).attr('width', 30).attr('class', 'myrect');
		}
		// 横向递减柱状图
		function renderRect1(){
			var marge = {
				top: 60,
				bottom: 60,
				left: 60,
				right: 60
			} //设置边距
			var dataset = [250, 210, 170, 130, 90]; //数据（表示矩形的宽度）
			var svg = d3.select('svg'),
				g = svg.append('g').attr('transform', `translate(${marge.top}, ${marge.left})`); // translate 设置位置
			
			var rectHeight = 30; // 矩形高度
			g.selectAll('rect').data(dataset).enter().append('rect')
				.attr('x', 20) // 设置左上点的x
				.attr('y', (d, i)=> {
					return i * rectHeight;
				})
				.attr('width', d=>d)
				.attr('height', rectHeight - 5)
				.attr('class', 'myrect');
		}
	</script>
</html>
